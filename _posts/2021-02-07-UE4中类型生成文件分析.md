---
clayout:     post
typora-root-url: ..
title:      UE4中C++类型生成文件分析
subtitle:   反射类型分析，生成文件分析
date:       2021-02-07
author:     bbkgl
header-img: img/post-bg-0018.jpg
catalog: true
tags:
    - UE4
    - C++
---

> 我有故人抱剑去
>
> 斩尽春风未肯归

要解释UE4 C++中的反射，很难不讲或者少讲生成文件（\*.generated.h 和 \*.gen.cpp）。这是对于开发者来说，最直接能接触到的部分，也是研究引擎中C++动态实现最

因为生成代码中有大量的宏，初见时让我觉得这不是给人看的23333。。。

但一点点跟着知乎上的教程，还是硬着头皮啃下来了，然后一一展开所有宏，揭开这个反射系统最外层的面纱。

### 生成文件展开

#### 简单的Object

首先在UE4中新建一个类，名字应该尽量短。。。否则会造成阅读困难，眼花缭乱。

HH.h

```cpp
// Fill out your copyright notice in the Description page of Project Settings.

#pragma once

#include "CoreMinimal.h"
#include "UObject/NoExportTypes.h"
#include "HH.generated.h"

/**
 * 
 */
UCLASS()
class CCREFLECTION_API UHH : public UObject
{
	GENERATED_BODY()

public:
	UFUNCTION(BlueprintCallable)
	int HHFunc(int a);

	UPROPERTY()
	int HHID;
	
};
```

HH.cpp

```cpp
// Fill out your copyright notice in the Description page of Project Settings.


#include "HH.h"

int UHH::HHFunc(int a)
{
}
```

```GENERATED_BODY()``` 宏进行了拼接。

```
   GENERATED_BODY()
-> BODY_MACRO_COMBINE()
...
-> CURRENT_FILE_ID##_##__LINE__##_GENERATED_BODY
```

其中 `CURRENT_FILE_ID` 在 `*.generated.h` 中定义。

![1612949922211](/cloud_img/1612949922211.png)