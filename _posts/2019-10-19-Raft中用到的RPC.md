---
layout:     post
title:      Raft中用到的RPC
subtitle:   分布式一致性问题
date:       2019-10-20
author:     bbkgl
header-img: img/post-bg-0002.jpg
catalog: true
tags:
    - 分布式存储
---

> 韶华不为少年留
>
> 恨悠悠
>
> 几时休

在阅读Raft论文的时候发现其中用到了三种RPC，都是由领导人发出：

- 心跳包RPC，用于维持领导人的权威
- 发送请求投票的 RPC，拉票
- 附加条目 RPC，用于其他服务器的日志复制

其实第一种和第三种是同一类型的RPC，只是在不同情况下作用不一样：当其entries域为空时，该RPC作为Leader的心跳；当entries域不为空时，请求其他节点将entries域中的log添加到自己的log中。

根据论文中的表达，使用的RPC如下：

- RequestVote RPC，拉票RPC
- AppendEntries RPC，日志复制和心跳包RPC

### RequestVote RPC

顾名思义，就是用来拉票的RPC，先来看下论文中对该RPC的图片描述：

![img](https://wx1.sinaimg.cn/large/006moDdjly1g84wngs6czj30kb0fh40x.jpg)

候选人调用给自己征集选票，

- 参数：

  - term：候选人的任期号
  - candidateId：候选人的ID，标识，比如主机号及端口号
  - lastLogIndex：候选人最后日志条目的索引值
  - lastLogTerm：候选人最后日志条目的任期号
- 返回值：

  - term：当前任期号，以便于候选人更新自己的任期号
  - voteGranted：候选人赢得了此张选票时为真，即被调用对象是否投票给该候选人
- 接受者要实现：
  - 如果候选人的任期小于当前任期，则返回false（不投票给你）
  - 如果 votedFor 为空或者为 candidateId，并且候选人的日志至少和自己一样新，那么就投票给他，也就是自己还没投给别人，且这个候选人合法的话，就投票给他

  