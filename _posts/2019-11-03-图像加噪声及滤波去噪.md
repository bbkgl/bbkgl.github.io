# 计算机视觉第二次作业

> 姓名：邹佳坤
> 
> 学号：21951159
>
> 指导教师：刘二腾
>
> language：C++
>
> 完整代码及效果图在cv_work2文件夹下，源程序文件main.cpp

## 加噪声

选用的黑白图片：

![](https://github.com/zjucstCourseProject/cv-erteng/blob/master/bbkgl/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A/cv_work2/salt.jpg)

### 添加椒盐噪声

代码：

```cpp
//给原图像增加椒盐噪声
//图象模拟添加椒盐噪声是通过随机获取像素点,并设置为高亮度点和低亮度点来实现的
//src_image为源图像，n为椒/盐像素点个数，返回含噪图像
cv::Mat add_salt_noise(const cv::Mat src_image, int n) {
    cv::Mat dst_image = src_image.clone();

    for (int k = 0; k < n; k++) {
        //随机取值行列，得到像素点(i,j)
        int i = rand() % dst_image.rows;
        int j = rand() % dst_image.cols;

        //图像通道判定
        if (dst_image.channels() == 1)//修改像素点(i,j)的像素值
        {
            dst_image.at<uchar>(i, j) = 255;     //盐噪声
        } else {
            dst_image.at<cv::Vec3b>(i, j)[0] = 255;
            dst_image.at<cv::Vec3b>(i, j)[1] = 255;
            dst_image.at<cv::Vec3b>(i, j)[2] = 255;
        }
    }

    for (int k = 0; k < n; k++) {
        //随机取值行列
        int i = rand() % dst_image.rows;
        int j = rand() % dst_image.cols;
        //图像通道判定
        if (dst_image.channels() == 1) {
            dst_image.at<uchar>(i, j) = 0;       //椒噪声
        } else {
            dst_image.at<cv::Vec3b>(i, j)[0] = 0;
            dst_image.at<cv::Vec3b>(i, j)[1] = 0;
            dst_image.at<cv::Vec3b>(i, j)[2] = 0;
        }
    }
    return dst_image;
}
```

效果展示：

![](cv_work2/salt.jpg)

可以看到图片上多了很多噪点，整体的色调没太大变化。

### 添加高斯噪声

代码：

```cpp
//生成高斯噪声
double generate_gaussian_noise(double mu, double sigma) {
    //定义小值
    const double epsilon = std::numeric_limits<double>::min();
    static double z0, z1;
    static bool flag = false;
    flag = !flag;
    //flag为假构造高斯随机变量X
    if (!flag)
        return z1 * sigma + mu;
    double u1, u2;
    //构造随机变量
    do {
        u1 = rand() * (1.0 / RAND_MAX);
        u2 = rand() * (1.0 / RAND_MAX);
    } while (u1 <= epsilon);
    //flag为真构造高斯随机变量
    z0 = sqrt(-2.0 * log(u1)) * cos(2 * CV_PI * u2);
    z1 = sqrt(-2.0 * log(u1)) * sin(2 * CV_PI * u2);
    return z0 * sigma + mu;
}

cv::Mat add_gaussian_noise(cv::Mat &src_img) {
    cv::Mat dst_img = src_img.clone();
    int channels = dst_img.channels();
    int row_n = dst_img.rows;
    int col_n = dst_img.cols * channels;
    if (dst_img.isContinuous()) {
        col_n *= row_n;
        row_n = 1;
    }
    for (int i = 0; i < row_n; i++) {
        for (int j = 0; j < col_n; j++) {
            int val = dst_img.ptr<uchar>(i)[j] + generate_gaussian_noise(2, 0.8) * 32;
            if (val < 0)
                val = 0;
            if (val > 255)
                val = 255;
            dst_img.ptr<uchar>(i)[j] = static_cast<uchar>(val);
        }
    }
    return dst_img;
}
```

效果展示：

![](cv_work2/gaussi.jpg)

出现了很多的噪点，整体色调变得淡了一些。

## 图像去噪

> 这里使用了opencv提供的滤波接口

### 中值滤波-椒盐噪声

代码：

```cpp
// 椒盐-中值滤波
cv::Mat img_salt_median;
cv::medianBlur(img_salt, img_salt_median, 3);
cv::imwrite(salt_median_out, img_salt_median);
```

效果：

![](cv_work2/salt_median.jpg)

### 高斯滤波-椒盐噪声

代码：

```cpp
// 椒盐-高斯滤波
cv::Mat img_salt_gaussi;
cv::GaussianBlur(img_salt, img_salt_gaussi, cv::Size(5, 5), 3, 3);
cv::imwrite(salt_gaussi_out, img_salt_gaussi);
```

效果：

![](cv_work2/salt_gaussi.jpg)


### 均值滤波-椒盐噪声

代码：

```cpp
// 椒盐-均值滤波
cv::Mat img_salt_mean;
cv::blur(img_salt, img_salt_mean, cv::Size(5, 5));
cv::imwrite(salt_mean_out, img_salt_mean);
```

效果：

![](cv_work2/salt_mean.jpg)

### 中值滤波-高斯噪声

代码：

```cpp
// 高斯-中值滤波
cv::Mat img_gaussi_median;
cv::medianBlur(img_gaussi, img_gaussi_median, 3);
cv::imwrite(gaussi_median_out, img_gaussi_median);
```

效果：

![](cv_work2/gaussi_median.jpg)

### 高斯滤波-高斯噪声

代码：

```cpp
// 高斯-高斯滤波
cv::Mat img_gaussi_gaussi;
cv::GaussianBlur(img_gaussi, img_gaussi_gaussi, cv::Size(5, 5), 3, 3);
cv::imwrite(gaussi_gaussi_out, img_gaussi_gaussi);
```

效果：

![](cv_work2/gaussi_gaussi.jpg)


### 均值滤波-高斯噪声

代码：

```cpp
// 高斯-均值滤波
cv::Mat img_gaussi_mean;
cv::blur(img_gaussi, img_gaussi_mean, cv::Size(5, 5));
cv::imwrite(gaussi_mean_out, img_gaussi_mean);
```

效果：

![](cv_work2/gaussi_mean.jpg)

## 分析总结

查阅了相关资料，并根据以上这些去噪的效果，可以总结出如下结论：

- 高斯滤波、均值滤波和和中值滤波都可以起到平滑图像，滤去噪声的功能
- 图像经过中值滤波后，高斯噪声没有被完全去除，椒盐噪声几乎被完全去除效果较好
- 图像经过均值滤波后不管是高斯噪声还是椒盐噪声大部分都没有被去除，只是稍微模糊化
- 经过高斯滤波后，高斯噪声和椒盐噪声几乎被很大程度的模糊化，粗看上去效果还可以，但是一旦放大，图像就特别模糊
- 没有一种十全十美的去除噪声方法，应根据处理目的，通过实际试验选择合适的方法。