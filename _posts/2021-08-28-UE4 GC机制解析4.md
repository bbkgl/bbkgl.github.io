---
clayout:     post
typora-root-url: ..
title:      UE4 GC机制解析（四）：Cluster（簇）
subtitle:   生命周期一致
date:       2021-08-28
author:     bbkgl
header-img: img/post-bg-0001.jpg
catalog: true
tags:
    - UE4
    - C++
---

> 远远围墙，隐隐茅堂。
>
> 飏青旗、流水桥旁。

Cluster中文叫“簇”，统一管理UE中将多个生命周期相同的UObject，以优化GC性能。

## Cluster的作用和原理

#### Cluster的作用

区别于其他编程语言中普适性的GC，UE作为游戏引擎，其GC机制也与游戏息息相关。比如UE结合游戏分帧执行的特性，GC机制使用了分帧清理。同时游戏中也存在一些生死相关的物体，在GC标记时可以一起被标记为可达或不可达。

在游戏开发中，有一些生命周期相同的物体，如果按照常规的可达性分析逻辑进行遍历的话，同生共死的父物体和子物体会一起被遍历。

基本的结构如下图：

![1630421649251](/cloud_img/1630421649251.png)

显然，这些生命周期一致的物体可以一同被标记为可达/不可达，而不是继续深搜/广搜标记，这样可以有效减少GC标记阶段的耗时。如下图中深色的对象（O2-O8），其生命周期一致，可一同被标记为可达。

![1630508018589](/cloud_img/1630508018589.png)

在 UE 中就使用了一种结构对生命周期一致的物体进行组织，这种结构叫做Cluster。当然，Cluster并不能非常广泛的用在所有的 UObject 上，适用 Cluster 的有粒子系统，蓝图节点等。

## Cluster创建与销毁




## GC过程中的Cluster

